
<!-- TODO: Remove all comments before deploying your code to production. -->
<!DOCTYPE html>
<html dir="ltr" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- TODO: Add a description of the page for better SEO and sharing previews. -->
    <meta
      name="description"
      content="Add a description to provide a brief summary of the content."
    />

    <!-- TODO: Insert a concise, descriptive title that summarizes your page's content. -->
    <title>Basic Page Template (EN)</title>

    <!---------- GC Design System Utility ---------->
    <!-- TODO: Replace <version-number> with the latest version number to receive corresponding updates of the GC Design System utility framework. All notable changes will be documented in the changelog: https://github.com/cds-snc/gcds-utility/blob/main/CHANGELOG.md -->
    <link
      rel="stylesheet"
      href="https://cdn.design-system.alpha.canada.ca/@cdssnc/gcds-utility@1.9.2/dist/gcds-utility.min.css"
    />

    <!---------- GC Design System Components ---------->
    <!-- TODO: Replace <version-number> with the latest version number to receive corresponding updates of GC Design System Components. All notable changes will be documented in the changelog: https://github.com/cds-snc/gcds-components/blob/main/CHANGELOG.md -->
    <link
      rel="stylesheet"
      href="https://cdn.design-system.alpha.canada.ca/@cdssnc/gcds-components@0.40.0/dist/gcds/gcds.css"
    />
    <script
      type="module"
      src="https://cdn.design-system.alpha.canada.ca/@cdssnc/gcds-components@0.40.0/dist/gcds/gcds.esm.js"
    ></script>

    <!-- Custom styles -->
    <!-- TODO: If needed, uncomment and link your custom CSS file here. -->
    <!-- <link rel="stylesheet" href="path/to/custom.css" /> -->
  </head>

  <body>
    <!---------- Header ---------->
    <!-- TODO: Modify the lang-href to set the language toggle's URL. -->
    <!-- TODO: Update the skip-to-href with the main content container's id. -->
    <gcds-header lang-href="#" skip-to-href="#main-content">
      <!-- The slot="search" attribute adds the search component to the header. -->
      <gcds-search slot="search"></gcds-search>

      <!-- The slot="breadcrumb" attribute adds the breadcrumbs component to the header. -->
      <gcds-breadcrumbs slot="breadcrumb">
        <!-- TODO: Adjust the breadcrumb links with the correct ones for your site. -->
        <gcds-breadcrumbs-item href="#">Link</gcds-breadcrumbs-item>
        <gcds-breadcrumbs-item href="#">Link</gcds-breadcrumbs-item>
      </gcds-breadcrumbs>
    </gcds-header>

    <!---------- Main content ---------->
    <!-- TODO: Confirm the id matches the "skip-to-href" id in the header. -->
    <gcds-container
      id="main-content"
      main-container
      size="xl"
      centered
      tag="main"
    >
      <!-- TODO: Update the heading and text content. -->
      <section>
        <gcds-heading tag="h1">Basic page</gcds-heading>
        <gcds-text>
          Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
          eiusmod tempor incididunt ut labore et dolore magna aliqua. Turp is
          egestas maecenas pharetra convallis posuere morbi leo urna.
        </gcds-text>
      </section>

      <section>
        <gcds-heading tag="h2">Section 1</gcds-heading>
        <gcds-text>
          Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
          eiusmod tempor incididunt ut labore et dolore magna aliqua. Turp is
          egestas maecenas pharetra convallis posuere morbi leo urna.
        </gcds-text>

        <gcds-heading tag="h3">Subsection heading</gcds-heading>
        <gcds-text>
          Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
          eiusmod tempor incididunt ut labore et dolore magna aliqua. Turp is
          egestas maecenas pharetra convallis posuere morbi leo urna.
        </gcds-text>

        <gcds-heading tag="h3">Subsection heading</gcds-heading>
        <gcds-text>
          Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
          eiusmod tempor incididunt ut labore et dolore magna aliqua. Turp is
          egestas maecenas pharetra convallis posuere morbi leo urna.
        </gcds-text>
      </section>

      <section>
        <gcds-heading tag="h2">Section 2</gcds-heading>
        <gcds-text>
          Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
          eiusmod tempor incididunt ut labore et dolore magna aliqua. Turp is
          egestas maecenas pharetra convallis posuere morbi leo urna.
        </gcds-text>
      </section>

      <section>
        <gcds-heading tag="h2">Section 3</gcds-heading>
        <gcds-text>
          Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
          eiusmod tempor incididunt ut labore et dolore magna aliqua. Turp is
          egestas maecenas pharetra convallis posuere morbi leo urna.
        </gcds-text>
      </section>

      <!-- TODO: Update the date to reflect the page's most recent change. -->
      <gcds-date-modified>2024-08-22</gcds-date-modified>
    </gcds-container>

    <!---------- Footer ---------->
    <!-- TODO: Update or remove the contextual footer heading and links as needed. -->
    <gcds-footer
      display="full"
      contextual-heading="Canadian Digital Service"
      contextual-links='{ "Why GC Notify": "#","Features": "#", "Activity on GC Notify": "#"}'
    >
    </gcds-footer>
  
<script>
(function(){
  function addCSS(href){
    return new Promise(function(resolve,reject){
      if ([...document.styleSheets].some(s => s.href && s.href.includes('datatables'))) return resolve();
      var l=document.createElement('link'); l.rel='stylesheet'; l.href=href;
      l.onload=resolve; l.onerror=reject; document.head.appendChild(l);
    });
  }
  function addScript(src){
    return new Promise(function(resolve,reject){
      if ([...document.scripts].some(s => s.src && s.src.includes(src.split('/').pop()))) return resolve();
      var s=document.createElement('script'); s.src=src; s.defer=true;
      s.onload=resolve; s.onerror=reject; document.head.appendChild(s);
    });
  }
  async function ensureDataTables(){
    // jQuery + DataTables (1.13.x)
    if (!window.jQuery) await addScript("https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js");
    if (!jQuery.fn || !jQuery.fn.dataTable) {
      await addCSS("https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css");
      await addScript("https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js");
    }
  }

  async function main(){
    await ensureDataTables();

    const res = await fetch('./report.json', {cache: 'no-store'});
    const data = await res.json();

    const rows = (data.rows || []).map(r => ([
      r.owner_org || '',
      r.tracking_number || '',
      r.c_request_number || '',
      (r.informal_requests_sum || 0),
      r.unique_identifiers || '',
      r.summary_en || '',
      r.summary_fr || ''
    ]));

    const table = document.getElementById('report');
    const tbody = table.querySelector('tbody');
    // Fill tbody fast via DocumentFragment
    const frag = document.createDocumentFragment();
    for (const row of rows) {
      const tr = document.createElement('tr');
      for (let i=0;i<row.length;i++){
        const td = document.createElement('td');
        if (i>=5) td.className = 'small'; // summaries
        td.textContent = (row[i] == null) ? '' : String(row[i]);
        tr.appendChild(td);
      }
      frag.appendChild(tr);
    }
    tbody.innerHTML = '';
    tbody.appendChild(frag);

    // Initialize DataTables
    const dt = jQuery(table).DataTable({
      pageLength: 25,
      lengthMenu: [[10,25,50,100,-1],[10,25,50,100,"All"]],
      order: [[0, "asc"]],
      deferRender: true,
      autoWidth: false,
      layout: {
        topStart: 'search',
        topEnd: 'pageLength',
        bottomStart: 'info',
        bottomEnd: 'paging'
      },
      columnDefs: [
        { targets: [5,6], searchable: true }, // summaries searchable
        { targets: [3], className: 'dt-right' } // numeric align
      ]
    });

    // Optional stats: show counts above table using GCDS text
    const host = document.querySelector('#main-content') || document.body;
    const statsId = 'bn-ati-stats';
    if (!document.getElementById(statsId)) {
      const s = document.createElement('section');
      s.id = statsId;
      s.innerHTML = `
        <gcds-text>
          <strong>Summary</strong> —
          A: ${Number(data.meta?.counts?.A_rows||0).toLocaleString()} ·
          B: ${Number(data.meta?.counts?.B_rows||0).toLocaleString()} ·
          C: ${Number(data.meta?.counts?.C_rows||0).toLocaleString()} ·
          BC: ${Number(data.meta?.counts?.BC_rows||0).toLocaleString()} ·
          Matches: ${Number(data.meta?.counts?.matches||0).toLocaleString()}
        </gcds-text>`;
      host.insertBefore(s, host.querySelector('.table-wrap') || host.firstChild);
    }
  }

  main().catch(console.error);
})();
</script>
</body>
</html>

